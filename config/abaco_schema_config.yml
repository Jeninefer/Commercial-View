# Comprehensive Abaco Schema Configuration
# Generated from abaco_schema_autodetected.json
# This file provides complete schema mapping for all three Abaco data tables

# Schema Metadata
schema_info:
  version: "1.0.0"
  generation_date: "2024-12-19"
  source: "abaco_schema_autodetected.json"
  total_loans: 16205
  total_payments: 16443
  currency: "USD"
  companies:
    - "Abaco Technologies"
    - "Abaco Financial"

# Loan Data Table Schema (16,205 rows)
loan_data_schema:
  file_pattern: "Abaco - Loan Tape_Loan Data_Table.csv"
  expected_rows: 16205
  expected_columns: 28

  # Core columns with complete metadata
  columns:
    company:
      name: "Company"
      dtype: "string"
      nullable: false
      values: ["Abaco Technologies", "Abaco Financial"]

    customer_id:
      name: "Customer ID"
      dtype: "string"
      nullable: false
      pattern: "^CLIAB\\d{6}$"
      sample: ["CLIAB000198", "CLIAB000237", "CLIAB000225"]

    client_name:
      name: "Cliente"
      dtype: "string"
      nullable: false
      sample:
        [
          "SERVICIOS TECNICOS MEDICOS, S.A. DE C.V.",
          "KEVIN ENRIQUE CABEZAS MORALES",
        ]

    payer_name:
      name: "Pagador"
      dtype: "string"
      nullable: false
      sample:
        [
          'HOSPITAL NACIONAL "SAN JUAN DE DIOS" SAN MIGUEL',
          "ASSA COMPAÑIA DE SEGUROS, S.A.",
        ]

    application_id:
      name: "Application ID"
      dtype: "string"
      nullable: false
      pattern: "^DSB\\d{4}-\\d{3}$"
      sample: ["DSB1710-001", "DSB1704-007", "DSB1707-001"]

    loan_id:
      name: "Loan ID"
      dtype: "string"
      nullable: false
      pattern: "^DSB\\d{4}-\\d{3}$"
      sample: ["DSB1710-001", "DSB1704-007", "DSB1707-001"]

    product_type:
      name: "Product Type"
      dtype: "string"
      nullable: false
      values: ["factoring"]

    disbursement_date:
      name: "Disbursement Date"
      dtype: "datetime"
      nullable: false
      format: "YYYY-MM-DD"
      sample: ["2025-09-30", "2025-09-29", "2025-09-26"]

    tpv:
      name: "TPV"
      dtype: "float"
      nullable: false
      description: "Total Purchase Value"
      sample: [77175.0, 88.48, 39361.42]

    disbursement_amount:
      name: "Disbursement Amount"
      dtype: "float"
      nullable: false
      sample: [74340.75, 87.47, 38961.12]

    origination_fee:
      name: "Origination Fee"
      dtype: "float"
      nullable: false
      sample: [2508.19, 0.89, 354.25]

    origination_fee_taxes:
      name: "Origination Fee Taxes"
      dtype: "float"
      nullable: false
      sample: [326.06, 0.12, 46.05]

    loan_currency:
      name: "Loan Currency"
      dtype: "string"
      nullable: false
      values: ["USD"]

    interest_rate_apr:
      name: "Interest Rate APR"
      dtype: "float"
      nullable: false
      range: [0.0, 1.0]
      sample: [0.2947, 0.3699, 0.295]

    term:
      name: "Term"
      dtype: "int"
      nullable: false
      sample: [90, 30, 120]

    term_unit:
      name: "Term Unit"
      dtype: "string"
      nullable: false
      values: ["days"]

    payment_frequency:
      name: "Payment Frequency"
      dtype: "string"
      nullable: false
      values: ["bullet"]

    days_in_default:
      name: "Days in Default"
      dtype: "int"
      nullable: false
      range: [0, 999]
      sample: [0, 1, 3]

    loan_status:
      name: "Loan Status"
      dtype: "string"
      nullable: false
      values: ["Current", "Complete", "Default"]

    outstanding_loan_value:
      name: "Outstanding Loan Value"
      dtype: "float"
      nullable: false
      sample: [77175.0, 88.48, 39361.42]

  # Unused columns (all nulls)
  unused_columns:
    - "Pledge To"
    - "Pledge Date"
    - "Other"
    - "New Loan ID"
    - "New Loan Date"
    - "Old Loan ID"
    - "Recovery Date"
    - "Recovery Value"

# Historic Real Payment Table Schema (16,443 rows)
payment_history_schema:
  file_pattern: "Abaco - Loan Tape_Historic Real Payment_Table.csv"
  expected_rows: 16443
  expected_columns: 18

  columns:
    company:
      name: "Company"
      dtype: "string"
      nullable: false
      values: ["Abaco Financial", "Abaco Technologies"]

    customer_id:
      name: "Customer ID"
      dtype: "string"
      nullable: false
      sample: ["CLI2006", "CLIAB000223", "CLIAB000225"]

    client_name:
      name: "Cliente"
      dtype: "string"
      nullable: false
      sample: ["RAFAEL ALEXANDER AGUILAR AGUILAR", "SUPER MARINO, S.A. DE C.V."]

    payer_name:
      name: "Pagador"
      dtype: "string"
      nullable: false
      sample:
        [
          "ALUMA SYSTEMS EL SALVADOR SA DE CV",
          "OPERADORA Y PROCESADORA DE PRODUCTOS MARINOS S.A.",
        ]

    loan_id:
      name: "Loan ID"
      dtype: "string"
      nullable: false
      sample: ["DSB3135-001", "DSB1351-001", "DSB1524-004"]

    payment_date:
      name: "True Payment Date"
      dtype: "datetime"
      nullable: false
      format: "YYYY-MM-DD"
      sample: ["2025-09-30", "2025-09-29", "2025-09-27"]

    devolution:
      name: "True Devolution"
      dtype: "float"
      nullable: false
      sample: [0.0, 658.45, 0.01]

    total_payment:
      name: "True Total Payment"
      dtype: "float"
      nullable: false
      sample: [1524.02, 62115.89, 461.33]

    payment_currency:
      name: "True Payment Currency"
      dtype: "string"
      nullable: false
      values: ["USD"]

    principal_payment:
      name: "True Principal Payment"
      dtype: "float"
      nullable: false
      sample: [1377.22, 60270.32, 448.04]

    interest_payment:
      name: "True Interest Payment"
      dtype: "float"
      nullable: false
      sample: [94.48, 82.69, 7.69]

    fee_payment:
      name: "True Fee Payment"
      dtype: "float"
      nullable: false
      sample: [35.43, 1550.56, 4.07]

    tax_payment:
      name: "True Tax Payment"
      dtype: "float"
      nullable: false
      sample: [12.28, 10.75, 1.0]

    fee_tax_payment:
      name: "True Fee Tax Payment"
      dtype: "float"
      nullable: false
      sample: [4.61, 201.57, 0.53]

    rebates:
      name: "True Rabates"
      dtype: "int"
      nullable: false
      values: [0]

    outstanding_value:
      name: "True Outstanding Loan Value"
      dtype: "float"
      nullable: false
      sample: [0.0, 8054.78, 78.77]

    payment_status:
      name: "True Payment Status"
      dtype: "string"
      nullable: false
      values: ["Late", "On Time", "Prepayment"]

  unused_columns:
    - "True Other Payment"

# Payment Schedule Table Schema (16,205 rows)
payment_schedule_schema:
  file_pattern: "Abaco - Loan Tape_Payment Schedule_Table.csv"
  expected_rows: 16205
  expected_columns: 16

  columns:
    company:
      name: "Company"
      dtype: "string"
      nullable: false
      values: ["Abaco Technologies", "Abaco Financial"]

    customer_id:
      name: "Customer ID"
      dtype: "string"
      nullable: false
      sample: ["CLIAB000078", "CLIAB000165", "CLIAB000100"]

    client_name:
      name: "Cliente"
      dtype: "string"
      nullable: false
      sample:
        [
          "MYRNA DEL CARMEN GARCIA DE ARAUJO",
          "TRES DE TRES TRANSPORTES, S.A. DE C.V.",
        ]

    payer_name:
      name: "Pagador"
      dtype: "string"
      nullable: false
      sample:
        ["OSCAR ANTONIO ISLEÑO LOVO", "ADQUISICIONES EXTERNAS, S.A. DE C.V."]

    loan_id:
      name: "Loan ID"
      dtype: "string"
      nullable: false
      sample: ["DSB1613-006", "DSB0849-001", "DSB0629-005"]

    payment_date:
      name: "Payment Date"
      dtype: "datetime"
      nullable: false
      format: "YYYY-MM-DD"
      sample: ["2025-10-02", "2025-06-06", "2024-11-07"]

    tpv:
      name: "TPV"
      dtype: "float"
      nullable: false
      sample: [1847.7, 21784.0, 1731.5]

    total_payment:
      name: "Total Payment"
      dtype: "float"
      nullable: false
      sample: [1876.930614, 21889.957376, 1558.35]

    currency:
      name: "Currency"
      dtype: "string"
      nullable: false
      values: ["USD"]

    principal_payment:
      name: "Principal Payment"
      dtype: "float"
      nullable: false
      sample: [1827.87, 18857.61, 1524.28]

    interest_payment:
      name: "Interest Payment"
      dtype: "float"
      nullable: false
      sample: [25.8678, 2021.5552, 0.0]

    fee_payment:
      name: "Fee Payment"
      dtype: "float"
      nullable: false
      sample: [17.55, 661.94, 30.15]

    tax_payment:
      name: "Tax Payment"
      dtype: "float"
      nullable: false
      sample: [5.644314, 348.854376, 3.9195]

    outstanding_value:
      name: "Outstanding Loan Value"
      dtype: "int"
      nullable: false
      values: [0]

  unused_columns:
    - "Other Payment"
    - "All Rebates"

# Data Quality Rules
data_quality:
  loan_data:
    required_columns:
      [
        "Company",
        "Customer ID",
        "Loan ID",
        "Disbursement Amount",
        "Days in Default",
      ]
    unique_keys: ["Loan ID"]
    date_columns: ["Disbursement Date"]
    numeric_columns:
      [
        "TPV",
        "Disbursement Amount",
        "Interest Rate APR",
        "Outstanding Loan Value",
      ]

  payment_history:
    required_columns:
      [
        "Company",
        "Customer ID",
        "Loan ID",
        "True Payment Date",
        "True Total Payment",
      ]
    date_columns: ["True Payment Date"]
    numeric_columns:
      ["True Total Payment", "True Principal Payment", "True Interest Payment"]

  payment_schedule:
    required_columns:
      ["Company", "Customer ID", "Loan ID", "Payment Date", "Total Payment"]
    date_columns: ["Payment Date"]
    numeric_columns: ["TPV", "Total Payment", "Principal Payment"]

# Business Rules
business_rules:
  currency_validation:
    allowed_currencies: ["USD"]
    default_currency: "USD"

  loan_status_mapping:
    "Current": "active"
    "Complete": "closed"
    "Default": "default"

  payment_status_mapping:
    "On Time": "current"
    "Late": "delinquent"
    "Prepayment": "prepaid"

  delinquency_thresholds:
    current: [0, 0]
    early: [1, 30]
    moderate: [31, 60]
    late: [61, 90]
    severe: [91, 120]
    default: [121, 180]
    npl: [181, 999]

# Export Configuration
export_settings:
  file_naming:
    timestamp_format: "%Y%m%d_%H%M%S"
    loan_data_prefix: "abaco_loans"
    payment_history_prefix: "abaco_payments"
    payment_schedule_prefix: "abaco_schedule"

  formats:
    csv: true
    json: true
    parquet: false

  compression:
    enabled: false
    format: "gzip"
